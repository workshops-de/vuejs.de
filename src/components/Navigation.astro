---
import NavigationBanner from './NavigationBanner.astro';
import LanguagePicker from './LanguagePicker.astro';
import { siteConfig } from '../config/site';
import { getLangFromUrl, useTranslations, useTranslatedPath } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const currentPath = Astro.url.pathname;

// Navigation items with i18n support
const navItems = [
  {
    href: translatePath('/artikel/'),
    label: t('nav.articles'),
    pattern: '/artikel',
    icon: 'document-text'
  },
  {
    href: lang === 'en' ? '/en/articles/vuejs-tutorial-for-beginners/' : '/artikel/vuejs-tutorial-deutsch-anfaenger/',
    label: t('nav.tutorial'),
    pattern: '/tutorial',
    icon: 'book-open'
  },
  {
    href: lang === 'en' ? '/en/training/vuejs-typescript/' : '/schulungen/vuejs-typescript/',
    label: t('nav.training'),
    pattern: lang === 'en' ? '/training' : '/schulungen',
    icon: 'academic-cap'
  },
];

const isActive = (pattern: string) => currentPath.includes(pattern);
---


<div class="sticky top-0 z-50 bg-white/95 dark:bg-gray-950/95 backdrop-blur-sm border-b border-gray-100 dark:border-gray-800">
  <NavigationBanner />

  <nav class="container mx-auto px-4">
    <div class="flex items-center h-18 py-3">
      <!-- Logo -->
      <a href={translatePath('/')} class="flex items-center flex-shrink-0">
        <img
          src="/assets/img/logo-with-poweredby.svg"
          alt={`${siteConfig.title} powered by workshops.de`}
          class="h-10 md:h-12 dark:brightness-0 dark:invert"
        />
      </a>

      <!-- Mobile menu button -->
      <button
        type="button"
        class="md:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 ml-auto text-gray-700 dark:text-gray-300"
        aria-label="Toggle menu"
        onclick="document.getElementById('mobile-menu').classList.toggle('hidden')"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>

      <!-- Desktop navigation - centered -->
      <div class="hidden md:flex items-center justify-center gap-10 flex-1">
        {navItems.map(item => (
          <a
            href={item.href}
            class={`flex items-center gap-1.5 text-xl font-semibold transition-colors ${
              isActive(item.pattern)
                ? 'text-primary'
                : 'text-gray-700 dark:text-gray-300 hover:text-primary'
            }`}
          >
            {item.icon === 'document-text' && (
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
            )}
            {item.icon === 'book-open' && (
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
              </svg>
            )}
            {item.icon === 'academic-cap' && (
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M12 14l9-5-9-5-9 5 9 5z"></path>
                <path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222"></path>
              </svg>
            )}
            {item.label}
          </a>
        ))}
      </div>

      <!-- Right side: Search + Language -->
      <div class="hidden md:flex items-center gap-3 flex-shrink-0">
        <!-- Search Button -->
        <a
          href={translatePath('/suche/')}
          class="p-2.5 text-gray-600 dark:text-gray-300 hover:text-primary transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 border border-gray-200 dark:border-gray-700"
          title={t('nav.search')}
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </a>

        <!-- Language Switcher -->
        <LanguagePicker />

        <!-- Dark Mode Toggle -->
        <button
          id="dark-mode-toggle"
          class="p-2.5 text-gray-600 dark:text-gray-300 hover:text-primary transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 border border-gray-200 dark:border-gray-700"
          title={t('darkMode.toggle')}
        >
          <!-- Sun icon (shown in dark mode) -->
          <svg class="w-4 h-4 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
          </svg>
          <!-- Moon icon (shown in light mode) -->
          <svg class="w-4 h-4 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
          </svg>
        </button>
      </div>

    </div>

    <!-- Mobile navigation with language option -->
    <div id="mobile-menu" class="hidden md:hidden pb-4">
      <div class="flex flex-col gap-2">
        {navItems.map(item => (
          <a
            href={item.href}
            class={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium ${
              isActive(item.pattern)
                ? 'bg-primary-50 dark:bg-primary-900/30 text-primary'
                : 'text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800'
            }`}
          >
            {item.icon === 'document-text' && (
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
            )}
            {item.icon === 'book-open' && (
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
              </svg>
            )}
            {item.icon === 'academic-cap' && (
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M12 14l9-5-9-5-9 5 9 5z"></path>
                <path d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222"></path>
              </svg>
            )}
            {item.label}
          </a>
        ))}

        <!-- Mobile Search Link -->
        <a
          href={translatePath('/suche/')}
          class={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium ${
            isActive('/suche')
              ? 'bg-primary-50 dark:bg-primary-900/30 text-primary'
              : 'text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800'
          }`}
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
          {t('nav.search')}
        </a>

        <!-- Mobile Language & Dark Mode -->
        <div class="px-4 pt-2 flex gap-2">
          <a
            href="/"
            class:list={[
              "lang-option-mobile flex-1 py-2 rounded-lg font-medium text-sm border border-gray-200 dark:border-gray-700 flex items-center justify-center gap-2",
              lang === 'de'
                ? "bg-primary-50 dark:bg-primary-900/30 text-primary"
                : "text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800"
            ]}
          >
            ðŸ‡©ðŸ‡ª Deutsch
          </a>
          <a
            href="/en/"
            class:list={[
              "lang-option-mobile flex-1 py-2 rounded-lg font-medium text-sm border border-gray-200 dark:border-gray-700 flex items-center justify-center gap-2",
              lang === 'en'
                ? "bg-primary-50 dark:bg-primary-900/30 text-primary"
                : "text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800"
            ]}
          >
            ðŸ‡¬ðŸ‡§ English
          </a>
          <button
            id="dark-mode-toggle-mobile"
            class="py-2 px-4 rounded-lg font-medium text-sm border border-gray-200 dark:border-gray-700 flex items-center justify-center gap-2 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800"
          >
            <svg class="w-4 h-4 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
            </svg>
            <svg class="w-4 h-4 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </nav>
</div>

<script is:inline>
  // ==================== DARK MODE ====================
  // Following Tailwind CSS docs: https://tailwindcss.com/docs/dark-mode#toggling-dark-mode-manually

  // Toggle dark mode
  function toggleDarkMode() {
    const isDark = document.documentElement.classList.contains('dark');
    if (isDark) {
      // User explicitly chooses light mode
      document.documentElement.classList.remove('dark');
      localStorage.theme = 'light';
    } else {
      // User explicitly chooses dark mode
      document.documentElement.classList.add('dark');
      localStorage.theme = 'dark';
    }
  }

  // Listen for system theme changes (only when no explicit user preference)
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
    if (!('theme' in localStorage)) {
      document.documentElement.classList.toggle('dark', e.matches);
    }
  });

  // Dark mode toggle buttons
  document.getElementById('dark-mode-toggle')?.addEventListener('click', toggleDarkMode);
  document.getElementById('dark-mode-toggle-mobile')?.addEventListener('click', toggleDarkMode);
</script>

